<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Compras no caixa</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <h2>Simulador de caixa</h2>
    <label
      >Pesquisar produto:
      <input
        type="text"
        oninput="pesquisar()"
        id="barraPesquisa"
        placeholder="Digite o nome do produto"
      />
    </label>
    <br /><br />
    <label
      >Produto:
      <input type="text" id="produto" placeholder="Digite o nome do produto" />
    </label>
    <br /><br />
    <label
      >Valor (R$)
      <input type="number" id="valor" placeholder="Digite o valor do produto" />
    </label>
    <br /><br />
    <label
      >Quantidade:
      <input type="number" id="quantidade" placeholder="Digite a quantidade" />
    </label>
    <br /><br />

    <button onclick="adicionarItem()">Adicionar</button>
    <button onclick="limparTudo()">Limpar tudo</button>
    <button onclick="finalizarCompra()">Finalizar compra</button>
    <br /><br />

    <h3>Itens no carrinho:</h3>
    <ul id="itensLista"></ul>
    <h3>Total: R$ <span id="valorTotal">0.00</span></h3>

    <h3>Produtos dispon√≠veis:</h3>
    <div id="produtos">
      <div id="divProdutos" class="produtos-container"></div>
    </div>

    <div id="fundo" class="hidden"></div>

    <div id="popUp" class="hidden">
      <h3>Seu carrinho possui:</h3>
      <div id="interna">
        <ul id="itensListaPopUp"></ul>
        <h3>Total a pagar:</h3>
        <span id="valorTotalPopUp">0.00</span>
        <br><br />
        <label for="forma-pagamento">Forma de pagamento:</label>
        <select id="forma-pagamento" name="forma-pagamento">
          <option value="credito">Cart√£o de Cr√©dito</option>
          <option value="debito">Cart√£o de D√©bito</option>
          <option value="pix">PIX</option>
          <option value="boleto">Boleto Banc√°rio</option>
          <option value="paypal">PayPal</option>
          <option value="dinheiro">Dinheiro</option>
        </select>
        <br /><br />
        <button id="aplicarDesconto">Aplicar 5% de desconto</button>
    <br><br />
        <h3>Pagamento: <input type="text" id="pagamento" placeholder="0.00"></h3>
        <h3 id="resultadoPagamento"></h3>
      </div>
      <button id="fecharPopup" class="hidden">Fechar</button>
    </div>

    <script>
      const listaProdutos = [
        {
          id: 1,
          nome: "üíä Paracetamol 500mg (20 comprimidos)",
          preco: 15.9,
          tags: [
            "analg√©sico",
            "antit√©rmico",
            "dor",
            "febre",
            "rem√©dio",
            "inflama√ß√£o",
            "gripe",
          ],
        },
        {
          id: 2,
          nome: "üíä Dipirona S√≥dica 1g (10 comprimidos)",
          preco: 9.5,
          tags: [
            "analg√©sico",
            "antit√©rmico",
            "dor",
            "febre",
            "rem√©dio",
            "inflama√ß√£o",
          ],
        },
        {
          id: 3,
          nome: "üíä Ibuprofeno 400mg (20 comprimidos)",
          preco: 18.7,
          tags: [
            "anti-inflamat√≥rio",
            "analg√©sico",
            "antit√©rmico",
            "dor",
            "inflama√ß√£o",
            "febre",
            "rem√©dio",
          ],
        },
        {
          id: 4,
          nome: "üçä Vitamina C 1g (30 comprimidos efervescentes)",
          preco: 25.0,
          tags: [
            "vitamina",
            "imunidade",
            "gripe",
            "resfriado",
            "preven√ß√£o",
            "sa√∫de",
          ],
        },
        {
          id: 5,
          nome: "üíä Multivitam√≠nico Completo (60 c√°psulas)",
          preco: 49.9,
          tags: [
            "vitamina",
            "imunidade",
            "energia",
            "sa√∫de",
            "bem-estar",
            "nutri√ß√£o",
          ],
        },
        {
          id: 6,
          nome: "üß¥ √Ålcool em Gel 70% (1kg)",
          preco: 23.5,
          tags: [
            "higiene",
            "antiss√©ptico",
            "m√£os",
            "limpeza",
            "preven√ß√£o",
            "bact√©rias",
            "v√≠rus",
          ],
        },
        {
          id: 7,
          nome: "üß¥ Hidratante Corporal Neutro (200ml)",
          preco: 22.9,
          tags: [
            "hidratante",
            "pele",
            "ressecamento",
            "cosm√©tico",
            "cuidado pessoal",
            "bem-estar",
          ],
        },
        {
          id: 8,
          nome: "‚òÄÔ∏è Protetor Solar FPS 50 (120ml)",
          preco: 59.9,
          tags: [
            "prote√ß√£o solar",
            "pele",
            "sol",
            "cosm√©tico",
            "dermatol√≥gico",
            "preven√ß√£o",
            "queimadura",
          ],
        },
        {
          id: 9,
          nome: "üß¥ Pomada para Assaduras (Dermatol√≥gica)",
          preco: 17.3,
          tags: [
            "pomada",
            "assadura",
            "pele",
            "dermatol√≥gico",
            "cuidado pessoal",
            "beb√™",
            "hidrata√ß√£o",
            "regenera√ß√£o",
          ],
        },
        {
          id: 10,
          nome: "üß¥ Spray Antiss√©ptico para Ferimentos (50ml)",
          preco: 14.2,
          tags: [
            "antiss√©ptico",
            "ferimento",
            "machucado",
            "corte",
            "limpeza",
            "bact√©rias",
            "primeiros socorros",
          ],
        },
        {
          id: 11,
          nome: "üíß Soro Fisiol√≥gico 0,9% (500ml)",
          preco: 7.8,
          tags: [
            "limpeza",
            "higiene",
            "nariz",
            "ferimento",
            "olhos",
            "hidrata√ß√£o",
            "primeiros socorros",
          ],
        },
        {
          id: 12,
          nome: "üå°Ô∏è Term√¥metro Digital",
          preco: 39.9,
          tags: [
            "febre",
            "term√¥metro",
            "medi√ß√£o",
            "sa√∫de",
            "diagn√≥stico",
            "preven√ß√£o",
          ],
        },
        {
          id: 13,
          nome: "üò∑ M√°scara Cir√∫rgica (caixa com 50 unidades)",
          preco: 35.0,
          tags: [
            "m√°scara",
            "prote√ß√£o",
            "preven√ß√£o",
            "higiene",
            "v√≠rus",
            "bact√©rias",
            "respirat√≥rio",
          ],
        },
        {
          id: 14,
          nome: "ü©π Esparadrapo Imperme√°vel (10m)",
          preco: 8.9,
          tags: [
            "curativo",
            "esparadrapo",
            "ferimento",
            "machucado",
            "primeiros socorros",
            "prote√ß√£o",
          ],
        },
        {
          id: 15,
          nome: "ü©π Curativo Adesivo (caixa com 40 unidades)",
          preco: 12.0,
          tags: [
            "curativo",
            "ferimento",
            "corte",
            "machucado",
            "prote√ß√£o",
            "higiene",
            "primeiros socorros",
          ],
        },
        {
          id: 16,
          nome: "üß¥ Shampoo Anticaspa (400ml)",
          preco: 29.9,
          tags: [
            "caspa",
            "shampoo",
            "anticaspa",
            "cabelo",
            "couro cabeludo",
            "higiene",
            "dermatol√≥gico",
          ],
        },
        {
          id: 17,
          nome: "üß¥ Desodorante Roll-on (60ml)",
          preco: 9.9,
          tags: [
            "desodorante",
            "higiene",
            "axilas",
            "odor",
            "prote√ß√£o",
            "cuidado pessoal",
          ],
        },
        {
          id: 18,
          nome: "üßº Sabonete L√≠quido Antiss√©ptico (250ml)",
          preco: 16.5,
          tags: [
            "sabonete",
            "antiss√©ptico",
            "higiene",
            "pele",
            "bact√©rias",
            "v√≠rus",
            "limpeza",
          ],
        },
        {
          id: 19,
          nome: "üíÑ Hidratante Labial com FPS",
          preco: 11.2,
          tags: [
            "hidratante",
            "labial",
            "l√°bios",
            "ressecamento",
            "sol",
            "prote√ß√£o",
            "dermatol√≥gico",
          ],
        },
        {
          id: 20,
          nome: "ü¶ü Repelente de Insetos (100ml)",
          preco: 24.7,
          tags: [
            "repelente",
            "inseto",
            "mosquito",
            "pele",
            "prote√ß√£o",
            "preven√ß√£o",
            "viagem",
            "campo",
          ],
        },
      ];

      mostrarProdutos(listaProdutos);
      const interna = document.getElementById("interna");
      const fecharPopup = document.getElementById("fecharPopup");
      const itensListaPopUp = document.getElementById("itensListaPopUp");
      const valorTotalPopUp = document.getElementById("valorTotalPopUp");
      const popUp = document.getElementById("popUp");
      const fundo = document.getElementById("fundo");
      const containerProdutos = document.getElementById("produtos");
      const barraPesquisa = document.getElementById("barraPesquisa");
      const aplicarDescontoBtn = document.getElementById("aplicarDesconto");
        aplicarDescontoBtn.addEventListener("click", () => {
    if (descontoAplicado) {
        alert("Desconto j√° foi aplicado.");
        return;
    }
    
    // Obt√©m o valor total atual do popup
    const totalAtual = parseFloat(valorTotalPopUp.textContent);
    
    // Calcula o desconto (5% do total atual)
    const desconto = totalAtual * 0.05;
    
    // Calcula o novo total com desconto
    const novoTotal = totalAtual - desconto;
    
    // Atualiza o valor exibido no popup
    valorTotalPopUp.textContent = novoTotal.toFixed(2);
    
    // Atualiza a vari√°vel global valorTotal (opcional, dependendo da sua necessidade)
    valorTotal = novoTotal;
    
    descontoAplicado = true;
    
    // Mostra mensagem com o valor do desconto e novo total
    alert(`Desconto de R$ ${desconto.toFixed(2)} aplicado!\nNovo total: R$ ${novoTotal.toFixed(2)}`);
    
    // Atualiza o c√°lculo do pagamento/troco se j√° houver valor digitado
    const pagamentoInput = document.getElementById('pagamento');
    if (pagamentoInput.value) {
        const event = new Event('input');
        pagamentoInput.dispatchEvent(event);
    }
});
      let descontoAplicado = false;
      let carrinho = [];
      let total = 0;

      let itens = [];
      let valorTotal = 0;

      function mostrarProdutos(produtos) {
        const container = document.getElementById("divProdutos");
        if (!container) return;
        container.innerHTML = "";
        produtos.forEach((produto) => {
          const div = document.createElement("div");
          div.className = "produto";
          div.innerHTML = `
          <button class="adicionar" onclick="adicionarItemImg('${
            produto.nome
          }', ${produto.preco})">
      <h4>${produto.nome}</h4>
      <img src="img/${produto.id}.webp" class="imagem" alt="${produto.nome}" />
      <p>R$ ${produto.preco.toFixed(2)}</p>
      Adicionar</button>
    `;
          container.appendChild(div);
        });
      }

      document.getElementById('pagamento').addEventListener('input', function() {
    const pagamento = parseFloat(this.value.replace(',', '.')) || 0;
    const troco = pagamento - total;

    let mensagem = '';

    if (troco < 0) {
        mensagem = `Faltam R$ ${Math.abs(troco).toFixed(2)}`;
    } else {
        mensagem = `Troco: R$ ${troco.toFixed(2)}`;
    }

    exibirResultado(mensagem);
});

function exibirResultado(mensagem) {
    let resultado = document.getElementById('resultadoPagamento');
    if (!resultado) {
        resultado = document.createElement('h3');
        resultado.id = 'resultadoPagamento';
        document.getElementById('interna').appendChild(resultado);
    }
    resultado.innerText = mensagem;
}

      function adicionarItemImg(nome, preco) {
        const produto = nome.trim();
        const valor = parseFloat(preco);
        const quantidade = 1;

        if (produto && !isNaN(valor)) {
          const index = itens.findIndex((item) => item.produto === produto);

          if (index !== -1) {
            itens[index].quantidade += quantidade;
          } else {
            const item = { produto, valor, quantidade };
            itens.push(item);
          }

          atualizarLista();
          calcularTotal();
        } else {
          alert("Por favor, preencha todos os campos corretamente.");
        }
      }
      function adicionarItem() {
        const produto = document.getElementById("produto").value.trim();
        const valor = parseFloat(document.getElementById("valor").value);
        const quantidade = parseInt(
          document.getElementById("quantidade").value
        );

        if (produto && !isNaN(valor) && !isNaN(quantidade) && quantidade > 0) {
          const item = { produto, valor, quantidade };
          itens.push(item);
          atualizarLista();
          calcularTotal();
          limparCampos();
        } else {
          alert("Por favor, preencha todos os campos corretamente.");
        }
      }

      function atualizarLista() {
        const lista = document.getElementById("itensLista");
        lista.innerHTML = "";
        itens.forEach((item, index) => {
          const li = document.createElement("li");
          li.textContent = `${item.quantidade}x ${item.produto} - R$ ${(
            item.valor * item.quantidade
          ).toFixed(2)}`;

          const botaoRemover = document.createElement("button");
          botaoRemover.textContent = "Remover";
          botaoRemover.onclick = () => removerItem(index);

          const botaoAdicionar = document.createElement("button");
          botaoAdicionar.textContent = "Adicionar unidade";
          botaoAdicionar.onclick = () => {
            item.quantidade++;

            atualizarLista();
            calcularTotal();
          };
        li.appendChild(botaoRemover);
          li.appendChild(botaoAdicionar);
          lista.appendChild(li);
        });
      }

      function removerItem(index) {
        itens.splice(index, 1);
        atualizarLista();
        calcularTotal();
      }

      function calcularTotal() {
        valorTotal = itens.reduce(
          (acc, item) => acc + item.valor * item.quantidade,
          0
        );
        document.getElementById("valorTotal").textContent =
          valorTotal.toFixed(2);
      }

      function limparCampos() {
        document.getElementById("produto").value = "";
        document.getElementById("valor").value = "";
        document.getElementById("quantidade").value = "";
      }

      function limparTudo() {
        itens = [];
        atualizarLista();
        calcularTotal();
      }

      function finalizarCompra() {
        if (itens.length === 0) {
          alert("Seu carrinho est√° vazio.");
          return;
        }
        popUp.classList.remove("hidden");
        fundo.classList.remove("hidden");
        itensListaPopUp.innerHTML = "";
        itens.forEach((item) => {
          const li = document.createElement("li");
          li.textContent = `${item.quantidade}x ${item.produto} - R$ ${(
            item.valor * item.quantidade
          ).toFixed(2)}`;
          itensListaPopUp.appendChild(li);
        });
        valorTotalPopUp.textContent = valorTotal.toFixed(2);
        
        document.getElementById('pagamento').addEventListener('input', function() {
          const pagamento = parseFloat(this.value.replace(',', '.')) || 0;
          const total = parseFloat(valorTotalPopUp.textContent);
          const troco = pagamento - total;

          let mensagem = '';

          if (troco < 0) {
              mensagem = `Faltam R$ ${Math.abs(troco).toFixed(2)}`;
              fecharPopup.classList.add("hidden");
              fecharPopup.disabled = true;
          } else {
              mensagem = `Troco: R$ ${troco.toFixed(2)}`;
                fecharPopup.classList.remove("hidden");
                fecharPopup.disabled = false;
          }

          document.getElementById('resultadoPagamento').innerText = mensagem;
        });
        
        limparTudo();
      }
      fecharPopup.addEventListener("click", () => {
        descontoAplicado = false;
        itens = [];
        valorTotal = 0;
        atualizarLista();
        calcularTotal();
        popUp.classList.add("hidden");
        fundo.classList.add("hidden");
      });

      function pesquisar() {
        const busca = barraPesquisa.value.toLowerCase();
        const produtosFiltrados = listaProdutos.filter(
          (produto) =>
            produto.nome.toLowerCase().includes(busca) ||
            produto.tags.some((tag) => tag.toLowerCase().includes(busca))
        );
        mostrarProdutos(produtosFiltrados);
      }
    </script>
  </body>
</html>
